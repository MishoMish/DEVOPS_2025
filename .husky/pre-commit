#!/bin/sh
# ===========================================
# Pre-Commit Hook - Quick lint on staged files
# ===========================================

echo "ğŸ” Running pre-commit checks..."
echo ""

# Get staged JS files in api-service
STAGED_JS=$(git diff --cached --name-only --diff-filter=ACM | grep '^api-service/.*\.js$' | sed 's|^api-service/||' || true)

if [ -z "$STAGED_JS" ]; then
  echo "âœ… No JavaScript files staged, skipping lint."
  exit 0
fi

cd api-service

# Ensure dependencies are installed
if [ ! -d "node_modules" ]; then
  echo "ğŸ“¦ Installing dependencies..."
  npm ci --silent
fi

# Run ESLint on staged files only
echo "ğŸ“ Linting staged files..."
npx eslint $STAGED_JS

if [ $? -ne 0 ]; then
  echo ""
  echo "âŒ Lint failed! Fix the errors above before committing."
  exit 1
fi

echo "âœ… Lint passed!"
