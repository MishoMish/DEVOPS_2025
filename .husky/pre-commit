#!/bin/sh
# ===========================================
# Pre-Commit Hook - Runs before each commit
# ===========================================
# This hook runs linting on staged files to catch issues early.
# If linting fails, the commit will be aborted.

echo "üîç Running pre-commit checks..."

# Navigate to api-service directory
cd api-service

# Run ESLint on staged JavaScript files only
echo "üìù Linting staged files..."
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(js|jsx|ts|tsx)$' | grep '^api-service/' | sed 's|^api-service/||')

if [ -n "$STAGED_FILES" ]; then
  npx eslint $STAGED_FILES
  LINT_EXIT_CODE=$?
  
  if [ $LINT_EXIT_CODE -ne 0 ]; then
    echo ""
    echo "‚ùå Linting failed! Please fix the errors above before committing."
    echo "üí° Tip: Run 'npm run lint -- --fix' to auto-fix some issues."
    exit 1
  fi
  echo "‚úÖ Linting passed!"
else
  echo "‚ÑπÔ∏è  No JavaScript files to lint."
fi

cd ..
echo "‚úÖ Pre-commit checks passed!"
